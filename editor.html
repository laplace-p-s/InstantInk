<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>InstantInk</title>
        <link rel="icon" href="/favicon.ico">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    </head>
    <body style="background-color: rgb(243 244 246);">
        <script>
            function save_announce(is_auto){
                var date = new Date();
                var Y = date.getFullYear();
                var M = ("00" + (date.getMonth()+1)).slice(-2);
                var D = ("00" + date.getDate()).slice(-2);
                var h = ("00" + date.getHours()).slice(-2);
                var m = ("00" + date.getMinutes()).slice(-2);
                var s = ("00" + date.getSeconds()).slice(-2);
                var date_text = Y + '/' + M + '/' + D + ' ' + h + ':' + m + ':' + s;
                if(is_auto){
                    $('#saveinfo').text('Auto Saved (' + date_text +')');
                }else{
                    $('#saveinfo').text('Saved (' + date_text +')');
                }
            };
            function auto_save(){
                if($('#auto_save_switch').prop("checked")){
                    $.post(window.location.href, {text: $('#editor').val()}, function() {
                        save_announce(true);
                    });
                }
            };

            $(document).ready(function() {
                $.get('file.txt', function(data) {
                    $('#editor').val(data);
                });
                $.get('fileinfo', function(data) {
                    $('#fileinfo').text(data);
                });
                $('#save').click(function() {
                    $.post(window.location.href, {text: $('#editor').val()}, function() {
                        save_announce(false);
                    });
                });
                $(window).bind('keydown', function(e) {
                    if (e.ctrlKey || e.metaKey) {
                        switch (String.fromCharCode(e.which).toLowerCase()) {
                            case 's':
                                e.preventDefault();
                                $.post(window.location.href, {text: $('#editor').val()}, function() {
                                    save_announce(false);
                                });
                                break;
                        }
                    }
                });
                // Auto save every 5 seconds
                setInterval(auto_save, 5000);
            });
        </script>
        <div style="padding-top: 20px;padding-left: 40px;padding-right: 40px;">
            <h1>InstantInk</h1>
            <hr style="margin-top: 0!important;margin-bottom: 1.5rem!important;">
            <div class="form-check form-switch">
                <label class="form-check-label" for="auto_save_switch">Auto Save</label>
                <input class="form-check-input" type="checkbox" id="auto_save_switch" name="auto_save_switch" checked>
            </div>
            <span id="fileinfo" style="margin-bottom: 5px; color: rgb(153 154 156);margin-right: 10px;"></span>
            <span id="saveinfo" style="margin-bottom: 5px; color: rgb(153 154 156);"></span>
            <textarea id="editor" class="form-control" style="width: 100%;" rows="20"></textarea>
        </div>
        <div style="padding-top: 20px;padding-left: 40px;padding-right: 40px;">
            <button id="save" class="btn btn-secondary">Save</button>
        </div>    
    </body>
</html>
